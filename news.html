<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Latest News - UK Developer Solutions Engineering</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="hero hero-small">
      <div class="hero-content">
        <h1>Latest News</h1>
      </div>
    </header>

    <nav class="breadcrumb"><a href="index.html">Home</a> / Latest News</nav>

    <main class="container">
      <section class="news-section">
        <div class="news-header" id="news-header">
          <span class="loading">Loading news feed...</span>
        </div>
        <div class="news-list" id="news-list"></div>
      </section>
    </main>

    <footer>
      <p>&copy; 2026 UK Developer Solutions Engineering</p>
    </footer>

    <script>
      const RSS_FEED_URL = "https://n.azure1.dev/feed";
      const CORS_PROXY = "https://api.allorigins.win/raw?url=";

      async function fetchNews() {
        try {
          const response = await fetch(CORS_PROXY + encodeURIComponent(RSS_FEED_URL));

          if (!response.ok) {
            throw new Error("Failed to fetch feed");
          }

          const text = await response.text();
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(text, "text/xml");

          const items = Array.from(xmlDoc.querySelectorAll("item"));
          const newsItems = items.map((item) => ({
            title: item.querySelector("title")?.textContent || "",
            link: item.querySelector("link")?.textContent || "",
            pubDate: new Date(item.querySelector("pubDate")?.textContent || ""),
          }));

          // Sort by date descending
          newsItems.sort((a, b) => b.pubDate - a.pubDate);

          displayNews(newsItems);
        } catch (error) {
          console.error("Error fetching news:", error);
          document.getElementById("news-header").innerHTML =
            '<span class="error">Unable to load news feed. Please try again later.</span>';
        }
      }

      function formatDate(date) {
        const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        return `${days[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
      }

      function getDayKey(date) {
        return `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
      }

      function getDayLabel(date) {
        const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        return days[date.getDay()] + ":";
      }

      function displayNews(items) {
        const now = new Date();
        const headerText = `Latest News - ${formatDate(now)} ${now.toTimeString().split(" ")[0]} GMT`;
        document.getElementById("news-header").innerHTML =
          `<h2>${headerText}</h2>`;

        // Group items by day
        const groupedByDay = {};
        items.forEach((item) => {
          const dayKey = getDayKey(item.pubDate);
          if (!groupedByDay[dayKey]) {
            groupedByDay[dayKey] = {
              date: item.pubDate,
              items: [],
            };
          }
          groupedByDay[dayKey].items.push(item);
        });

        // Sort days descending
        const sortedDays = Object.values(groupedByDay).sort(
          (a, b) => b.date - a.date,
        );

        const newsListEl = document.getElementById("news-list");
        newsListEl.innerHTML = "";

        sortedDays.forEach((day) => {
          const dayGroup = document.createElement("div");
          dayGroup.className = "news-day-group";

          const dayLabel = document.createElement("div");
          dayLabel.className = "news-day-label";
          dayLabel.textContent = getDayLabel(day.date);
          dayGroup.appendChild(dayLabel);

          const itemsList = document.createElement("div");
          itemsList.className = "news-items";

          day.items.forEach((item) => {
            const itemEl = document.createElement("a");
            itemEl.className = "news-item";
            itemEl.href = item.link;
            itemEl.target = "_blank";
            itemEl.rel = "noopener noreferrer";
            itemEl.innerHTML = `
              <span class="news-icon">â†—</span>
              <span class="news-title">${item.title}</span>
            `;
            itemsList.appendChild(itemEl);
          });

          dayGroup.appendChild(itemsList);
          newsListEl.appendChild(dayGroup);
        });
      }

      // Fetch news on page load
      fetchNews();
    </script>
  </body>
</html>
